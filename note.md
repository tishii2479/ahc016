# 全体を通して

- 方針は固めすぎない
    - 実装しすぎない
    - 思い込みをなくす
- 少しずつ改善する
- 何か問題特有のヒューリスティックは必要
    - ボトムアップに考える
    - 問題の観察を丁寧にする
- 貪欲の質を上げる

# 11/11

「次数列の復元 + グラフ構造を使ったヒューリスティック」がテーマっぽい

- 次数列の復元
    - 次数列の距離
- グラフ構造を使ったヒューリスティック
    - 連結成分の個数
    - 二部グラフ
    - ウニ
- M, epsが大きいときはNを大きめにする必要がありそう
- ある程度グラフを作ったら辺の接続を入れ替える焼きなまし?
- グラフ同士の距離が遠くなるように
- クエリのグラフからシミュレーションして、一番確率が高いグラフを出力

- M、epsごとに埋め込みができる
    - グラフの情報は整数で埋め込みできる

- 次数列の距離
    - 次数列をソートした時の各要素の差の二乗和
        ```
        d(0122, 0013) = 0 + 1 + 1 + 1 = 3
        ```
    - 必要な操作の最小か平均回数
- 次数列からグラフ構築
    - Havel-Hakimi
        - `O(N^2 log N)`
    - 普通にグラフから次数列を作るで良い
        - ソートで`O(N log N)`

- 復元方法
    - シミュレーションした結果、次数列の距離が最小なものを探す
        - epsが大きい時に厳しそう
    - シミュレーションし直すのか、二乗和を考えるだけ?
        - 実行時間5秒あるし、何かしらしそう
        - 必要な操作の最小か平均回数を求める

- 事前分布をなるべく離す
    - 辺の総数をなるべく離す
        - 等間隔でいいのか、次数列の分布を考えると不均一かも
    - 二項分布
        - `M = N * (N - 1) / 2`
        - `S = 元の辺の総数`
        - `T = 操作後の辺の総数`
        ```
        E(T | S, eps)
            = S * (1 - eps) + (M - S) * eps
            = S + (M - 2 * S) * eps
            = S * (1 - 2 * eps) + M * eps

        eps = 0     ->   1 * S
        eps = 0.4   -> 0.2 * S + 0.4 * M
        eps = 0.5   ->           0.5 * M
        ```
        - ランダムウォーク、マルコフ連鎖
        - `TODO:` ちゃんと確率分布`P(T | S, eps)`を考える
            - 周辺化で解けそう
- 次数の分布
    - 離した方がいいのか、一緒の方がいいのか
        - 他のサイズのグラフによる
            - ここが焼けそうな気がする
            - でも埋め込めるんだよな
        ```
        a = 4 1 1 1 1 0 0 0
        b = 2 2 2 2 0 0 0 0
        c = 7 1 1 1 1 1 1 1
        d = 2 2 2 2 2 2 2 0

        e = 2 2 2 2 2 0 0 0
        f = 5 1 1 1 1 1 0 0

        s(a) = s(b) = 8
        s(c) = s(d) = 14
        s(e) = 10

        d(a, e) = 8
        d(d, e) = 8
        ```
        - `TODO:` 本質は何か
- サイズ以外でグラフの距離を決めるのは
    - 次数の分布
    - 辺の接続の仕方は関係あるか
        - 同じ次数列でも違うグラフがある
        - 関係ありそう
            - 辺の接続が切り替わった時の次数列の変化がグラフによって変わるため
        - 関係あるなら、辺の接続は隣接行列で持つ必要がある
- 高速化
    - あらかじめ作ったmaskでxorをとる

# 11/12

- 橋の数は使えそう
    - 削除と追加が同じ確率で行われるので、そこまでかも
- グラフの距離は必要な操作の最小か平均回数
    - 頂点番号がないので、厳密に求めるのは難しい

## 方針

### 1. なるべく離れた位置にあるグラフを構築する

1. M個のグラフをランダムに初期化する
2. 隣接するグラフの距離が遠くなるように焼く
    - 辺の接続を入れ替える
    - 辺の接続先を変更する
3. 構築したグラフを出力する

### 2. クエリを受け取って復元する　

1. グラフを受け取る
2. 受け取ったグラフと構築したグラフの距離を求め、最も近いグラフを出力する

### 必要な要素

- グラフの距離の正確な定義
    - グラフの類似度を測る手法
    - 辺の削除、追加の必要回数
        - グラフ編集距離（Graph Edit Distance）の辺だけ
    - グラフの編集距離を求める問題はNP-Hard
        - 頂点をどう対応させるか（ノードマッピング）をA*アルゴリズムを使って最適化するとある程度のサイズまで解けるらしい
            - https://proceedings-of-deim.github.io/DEIM2022/papers/I44-1.pdf

- 頂点番号の対応付けを行うと、編集距離は計算できる
    - 対応付けを最適化して、編集距離を最小にした時の値を使う
        - 焼きなまし
            - 2頂点をswap
            - 遅い
        - ビームサーチ
            - 構築するときはこっち?
            - 早い
        - ある程度の貪欲

- M個のグラフの構築は工夫が必要
    - 全体の距離を考慮した評価関数を考える必要がある
- 復元するときには辺の追加、削除は考える必要がある

## 今後の方針

1. 構築
2. 復元

- 復元
    - Mが大きくても、最初に辺の総数によってある程度絞り込める
    - 難しい問題ほど時間を多く取る

# 11/13

類似度をより正確に、高速に求める

- ビームサーチで初期解を作る
- 編集距離の近似手法が必要かも

- グラフ生成の評価関数をminではなく総和に
    - 近い値を重視するために、距離の0.5乗を使う

- 辺の総数の平均の変化を考慮する必要がある
    - 特にepsが大きいとき
        -　辺の総数は `N * (N - 1) / 2` に近づく
    - グラフの単純な類似度だけだと、epsが大きい時に駄目

- epsが大きい時の対策を考える
    - 何回かシミュレーションして、その後類似度を求める
        - 相当良い
- m, epsが小さいときは強い

```
N = 30
ave: 6509895.81
err ave: 46.21
         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~40 |  44859999   26919002    8708427    3506621    6348444    1549501      24174      74430
   40~70 |  16277643    7419666    2225835     336712      63930      22186       8730       6471
  70~100 |  12251409    1337414     364372     130049      12719       6437       2570       2233
```

- 埋め込みはNの値だけしか無理そう
    - ファイルサイズは 512 KiB
    - 構築は後でやる必要がありそう
- 構築と復元の時間管理が必要
- Nの調整は結構大変

### 改善点

- epsが大きい時をもう少しまともに考える
- グラフの構築
    - 次数列の分布を考慮する
- グラフの類似度の求め方
    - 次数列の分布の類似度

### 現状の解法の整理

1. グラフの構築
    1. i番目に構築するグラフの辺の総数を`N * (N - 1) / 2 / (M - 1) * i`として、順番に頂点に辺を足す
2. グラフの復元
    1. 構築したグラフをモンテカルロでシミュレーションして、受け取ったグラフとの類似度を求める
        - 辺の総数が違いすぎるグラフはあらかじめ弾いている

### 改善点

- 類似度の求め方
    - 近い辺の数を持つグラフは構造で区別する
    - やはりグラフの構造を使いたい
        - 連結成分の個数、連結成分のサイズ
    - これを考慮したグラフの構築をする
- 他の復元方法の模索
- Nの最適化はしばらくしない

- 辺の総数を等間隔にしている
    - 最後の方が間違えやすいかも
- 辺の総数が隣のグラフに間違えることが多い
    - 隣のグラフと構造的に違いを作る
        - 次数列の分布の違い
            ```
            ooooo
            o
            o
            ooooo
            ```
            と
            ```
            o
            ooooo
            o
            ```
        - 連結成分のサイズ
            ```
            9 1 1 ... 1 0 ... 0 0
            3 3 ... 3 2 ... 2 2 1
            ```

### 研究テーマ

ノイズに強いグラフとは

### スコア観察

- epsが大きいときにちょっとスコアが下がってるかも
    - サンプル少ないだけ?

```
commit: 5616046
ave: 13615107.34
err ave: 8.22
         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~40 |  39500000   19027778   16666667   16190476   15833333   13490538    7233798    5806960
   40~70 |  32154672   20138889   11666666    9620000    9500000    8113180    3811784    1631015
  70~100 |  24687500   15055555   10357142    8840000    7860000    2839391     859418      46886
-------------------------------------------------------------------------------------------------

         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~40 |      0.20       0.17       0.00       0.29       0.50       2.50       4.40       9.00
   40~70 |      1.10       0.33       0.33       0.40       0.50       2.20      12.50      18.67
  70~100 |      0.12       1.00       0.43       1.20       2.33      15.00      24.50      60.57
-------------------------------------------------------------------------------------------------

commit: c76d0ee
ave: 16098469.64
err ave: 8.92
         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~40 |  46666666   27777777   22500000   19428571   19000000   12272512    5553155    5790968
   40~70 |  38447743   28194444   18416666    9800000    9500000    7978882    3797293    1841240
  70~100 |  32083333   14765901   11330165    9200000    8400000    3041891     938642      39552
-------------------------------------------------------------------------------------------------

         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~40 |      0.00       0.00       0.00       0.29       0.50       9.00       9.00       9.00
   40~70 |      1.30       0.33       0.67       0.20       0.50       2.40      12.33      17.67
  70~100 |      0.38       5.33       5.43       0.80       1.67      14.75      24.33      59.43
-------------------------------------------------------------------------------------------------

commit: 71b1abb
ave: 16178182.87
err ave: 8.9
         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~40 |  46666666   27777777   22500000   19428571   19000000   12677449    5872074    5785518
   40~70 |  38447743   28194444   18416666    9800000    9000000    7888793    3642909    1933536
  70~100 |  32916666   14407179   11410748    9200000    8130000    2940202     796059      44256
-------------------------------------------------------------------------------------------------

         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~40 |      0.00       0.00       0.00       0.29       0.50       8.33       8.40       9.14
   40~70 |      1.30       0.33       0.67       0.20       1.00       2.60      12.83      17.67
  70~100 |      0.12       5.67       5.43       0.80       2.00      15.50      25.50      58.57
-------------------------------------------------------------------------------------------------

commit: f9a95f0
if eps <= 0.3 || m <= 40 { f1, f2, f3 } else { f1, f2 }
ave: 16305794.89
err ave: 7.72
         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~40 |  46666666   27777777   22500000   19714285   19000000   12749018    5897919    5785518
   40~70 |  38447743   28194444   18416666    9800000    9000000    8390200    4345421    2576736
  70~100 |  32916666   14407179   11535276    9200000    8400000    3209126     976265     108559
-------------------------------------------------------------------------------------------------

         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~40 |      0.00       0.00       0.00       0.14       0.50       8.00       8.20       9.14
   40~70 |      1.30       0.33       0.67       0.20       1.00       1.80      11.17      15.00
  70~100 |      0.12       5.67       5.29       0.80       1.67      13.75      23.00      47.43
-------------------------------------------------------------------------------------------------
```

# 11/14

- 構築方法の模索
    - 次数列以外の類似度
    - 3つ目を作るか
        - 難しいM, epsの時は3つ目があった方が良さそう
        - 一様分布以外を考える
    - 類似度の計り方を工夫する
- 他の復元方法の模索
    - モンテカルロ以外

- 間違え方の集計をする
- 辺の総数の差は多分不均一が良いかも
    - 真ん中への近づき方が端っこの方が強い
    - 操作後の辺の総数を等間隔にしたい
        - 線形だから一緒か
    - でも予測のしやすさは違いそう

- 誤りが10あると大体スコアが0.1倍される
    - 10以上あるなら、N = 100にした方が良い

## TODO:

- モンテカルロ
    - 高速化
    - 中央値使うとか
- グラフの構造を使った類似度
- 次数列の分布の評価方法の検討
    - 現状はソートして2乗誤差
    - KLダイバージェンス
- Nの最適化

- 構築方法
    - 辺の総数が近いグラフ同士を区別したい
        - 接続している頂点同士の次数
        - 接続している頂点同士の共通している頂点
    - 違う構成方法であっても、似てしまう分布がある
        - ex: 0003 0と1, 44と45など
        - 辺の総数は不均一であっても良い
    - 似た頂点同士の関連
    - 二部グラフ
    - 構築したグラフを少し焼くのも良さそう
- 復元
    - 試行回数増やしても変わらない
    - 操作による分布のシフトが大きすぎる時には、復元の影響は少なくなる
    - スコアが近い時に何回かサンプリングし直す
    - 辺の総数も考慮する

```
commit: e642797
if eps <= 0.3 || m <= 40 { [f1, f2, f4] } else if eps >= 0.35 && m >= 70 { [f1, f2, f3, f4] } else { vec![f1, f2, f4, f3, f1, f2, f4] }
ave: 17832700.04
err ave: 5.53
         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~40 |  46666666   27777777   22500000   19714285   18100000   12238799    7468067    5642675
   40~70 |  46666666   29166666   16587416   10000000    9500000    9258000    6959328    4350907
  70~100 |  32499999   20325000   15363864   10000000    9333333    4915633    2344403     234353
-------------------------------------------------------------------------------------------------

         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~40 |      0.00       0.00       0.00       0.14       1.00       6.50       4.80       8.57
   40~70 |      0.00       0.00       1.67       0.00       0.50       0.80       3.67       8.00
  70~100 |      0.25       2.00       2.57       0.00       0.67       9.50      14.50      41.29
-------------------------------------------------------------------------------------------------
```

- 難しい時は分布を増やすと良い
- シミュレーションしたで平均を取る

- 分布の候補
```
--oooooooooo
--oooooooooo
oooo
oooo
oo
oo
oo
oo
oo
```

- 最初と最後が分布が被りやすい、かも?
- 分布を多く作って、離れるように選ぶ
    - ここを焼く or 山登り
        - 初期解は辺の総数を考慮してルールベースに作る
        - 近傍は隣のものを使う、スワップ
    - シミュレーション後の分布を作っておいて、それを比較する
    - 分布同士の類似度は事前に計算しておく
    - 前後10個の分布との距離の最小値の最大化

```
commit: 1e2b0d9
ave: 17900238.47
err ave: 5.52
         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~40 |  46666666   27777777   22500000   20000000   18100000   12398680    7224090    5602681
   40~70 |  46333333   28611111   18416666   10000000    9500000    9112200    6369252    4497762
  70~100 |  32916666   20325000   15721007    9800000    9333333    5218323    2400826     225690
-------------------------------------------------------------------------------------------------

         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~40 |      0.00       0.00       0.00       0.00       1.00       6.50       5.00       8.71
   40~70 |      0.10       0.17       0.67       0.00       0.50       1.00       4.67       7.67
  70~100 |      0.12       2.00       2.43       0.20       0.67       8.75      14.67      40.86
-------------------------------------------------------------------------------------------------
```

## 11/16

- 分布を多く作って、離れるように選ぶ
    - ここを焼く
        - 初期解は辺の総数を考慮してルールベースに作る
        - 辺の総数でソートしておく
            - 近傍は隣のものを使う、スワップ
    - シミュレーション後の分布を作っておいて、それを比較する
    - 分布同士の類似度は事前に計算しておく
        - クエリに答えるときもこれを使う
    - 前後10個の分布との距離の最小値の最大化


- 分布との距離の最小値の最大化だとうまくいかない
    - ある程度制限する必要がありそう
    - 制限してもだめ
    - 010101010を良いとする評価関数が必要
- 総和は最もだめ
    - 00000001111111みたいになる
- なるべく次数が均等なグラフを作る
- TODO: パラメータをまとめる

```
case=2000
ave: 16646882.614
err ave: 4.656
         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~40 |  41666666   26696165   23436956   19831914   17838916   11681766    8783634    5389942
   40~70 |  44320987   25982632   18908787   10284210   10077777    9010463    5975442    1511045
  70~100 |  42844659   24193193   14739435    9956140    9561022    6239299    2556891     430337
-------------------------------------------------------------------------------------------------

         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~40 |      0.00       0.00       0.04       0.09       1.21       6.21       2.70       8.69
   40~70 |      0.04       0.20       0.60       0.02       0.13       1.20       5.55      22.49
  70~100 |      0.26       0.93       2.84       0.04       0.46       5.16      14.81      36.46
-------------------------------------------------------------------------------------------------
```

```
model=sa
case=1000
ave: 16919912.356
err ave: 4.027
         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~20 |  48148147   27314814   22500000   20000000   20000000   19082625   10546750    9069898
   20~30 |  40350876   25490196   24210526   19875000   19076190   15506092    9728210    5279397
   30~40 |  42857142   26086956   23750000   19818181   17179931   10474958    8139391    3854040
   40~50 |  49019607   26022727   21666666   11428571   10588235    9880467    8255523    2271815
   50~60 |  39393939   26466666   19230769   10000000    9933333    9629166    6863401    1154385
   60~70 |  40350876   26712962   17881666   10000000    9952380    9491304    6395079    1460969
   70~80 |  37254901   25726190   17873500   10000000    9933333    8006897    3973491     743230
   80~90 |  44901960   23362812   15086608   10000000    9846153    7150254    2476741     301031
  90~100 |  41347618   23318205   14808033   10000000    9650000    4986916    3109237     149663
-------------------------------------------------------------------------------------------------

         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------　　------------------------------------------------------
   10~20 |      0.00       0.00       0.00       0.00       0.00       0.50       0.17       1.10
   20~30 |      0.00       0.00       0.00       0.06       0.48       2.58       1.29       8.77
   30~40 |      0.00       0.00       0.00       0.09       1.67       6.92       3.62      11.35
   40~50 |      0.00       0.05       0.13       0.00       0.00       0.45       2.00      17.73
   50~60 |      0.00       0.08       0.23       0.00       0.07       0.38       4.05      25.65
   60~70 |      0.00       0.06       0.47       0.00       0.05       0.52       5.12      22.79
   70~80 |      0.00       0.19       0.93       0.00       0.07       2.33       9.50      34.07
   80~90 |      0.06       1.12       1.85       0.00       0.15       3.37      16.14      37.40
  90~100 |      0.48       1.40       3.67       0.00       0.36       7.31      12.91      44.50
-------------------------------------------------------------------------------------------------

model=baseline
case=1000
ave: 16455288.254
err ave: 4.497
         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~20 |  48148147   27314814   22500000   20000000   19375000   17404834    9748556    7280817
   20~30 |  40350876   25490196   24078947   19875000   18169990   12870336    8599951    4929742
   30~40 |  42857142   26086956   23750000   19818181   17142174    8832418    7736803    3743984
   40~50 |  49019607   25909090   21333333   11428571   10529411    9453678    6624050    1941468
   50~60 |  39393939   26066666   18673076   10000000    9800000    8999370    5540921    1252216
   60~70 |  39999999   26388888   17094316   10000000    9904761    8693086    5265244    1264224
   70~80 |  37254901   25476190   17540166   10000000    9613333    6999230    3482517     609509
   80~90 |  44901960   23382291   13373958   10000000    9776923    6093934    2268215     442715
  90~100 |  40714285   22230868   14063250    9952380    9313571    4178809    2507955     185402
-------------------------------------------------------------------------------------------------

         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~20 |      0.00       0.00       0.00       0.00       0.31       1.75       1.00       3.67
   20~30 |      0.00       0.00       0.05       0.06       1.00       4.67       2.57       9.80
   30~40 |      0.00       0.00       0.00       0.09       1.67       8.92       4.29      11.88
   40~50 |      0.00       0.09       0.27       0.00       0.06       0.90       4.38      19.60
   50~60 |      0.00       0.24       0.46       0.00       0.20       1.08       6.18      23.12
   60~70 |      0.11       0.17       0.87       0.00       0.10       1.39       7.06      23.79
   70~80 |      0.00       0.29       1.07       0.00       0.40       3.75      11.81      34.71
   80~90 |      0.06       1.12       2.80       0.00       0.23       5.37      15.71      35.07
  90~100 |      0.67       1.93       3.93       0.05       0.71       9.31      14.35      43.25
-------------------------------------------------------------------------------------------------

model=baseline, param-tuned
case=1000
ave: 22339014.629
err ave: 5.173
         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~20 | 101162284   59432571   37770057   33145876   21296508   17673472   11478402    7376162
   20~30 |  80085060   46080908   34724359   25304669   18361761   14004515    9222592    4647873
   30~40 |  72193877   42941910   30382977   22179891   17816797   13175182    9014449    3444492
   40~50 |  66270198   33714005   28437342   20083806   14920279   11597224    6306282    1961989
   50~60 |  53961340   32401522   23838956   18286194   13767633    9614006    5397363    1175166
   60~70 |  47747149   30074557   20969287   16538119   11428763    8585250    5420137    1295886
   70~80 |  44094909   27285186   20447419   14393020   11081168    7217574    3539447     608056
   80~90 |  49607386   23722771   16623232   13905781   10983338    6364684    2384340     439199
  90~100 |  45077625   23826115   16031475   11809165   10264886    3935286    2227385     141477
-------------------------------------------------------------------------------------------------

         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~20 |      1.33       1.17       2.40       1.42       2.31       1.81       1.88       4.14
   20~30 |      1.84       1.29       1.58       1.75       2.05       2.54       2.76      10.66
   30~40 |      0.79       1.30       1.38       1.68       1.39       1.54       2.48      12.41
   40~50 |      1.18       1.73       1.53       0.64       1.41       1.10       5.23      19.80
   50~60 |      1.18       1.16       1.15       1.43       1.33       1.75       6.82      24.12
   60~70 |      1.16       1.06       1.40       1.29       1.81       2.30       6.94      23.14
   70~80 |      1.35       1.57       1.27       1.65       1.20       3.75      11.69      34.79
   80~90 |      1.24       1.38       2.10       1.32       1.00       5.26      15.29      35.13
  90~100 |      0.90       1.33       2.40       1.86       1.43       9.92      15.96      44.33
-------------------------------------------------------------------------------------------------

model=sa, param-tuned
case=1000
ave: 23699662.609
err ave: 4.37
         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~20 | 106913644   62713808   46006517   36161121   25934373   20277041   13663551    9786490
   20~30 |  85330100   49025165   38549890   27444889   21203981   15848585   10535910    5223718
   30~40 |  74331774   43652638   32385310   24564853   19513460   13812416    9433631    4117024
   40~50 |  68570924   35094374   26720959   20492247   16522580   12232504    7215618    2302249
   50~60 |  55621399   32705512   23718967   18847344   14974454   10577665    6997801    1374059
   60~70 |  48718620   31068944   21755057   17258567   12781493    9841190    6227885    1461485
   70~80 |  44836271   27927933   21210328   15720499   12083398    8563494    4045917     759124
   80~90 |  49549636   23975748   17797657   14765292   10991895    7084502    2563945     472141
  90~100 |  44086195   24051585   17652867   13031300   10866764    4869229    2834778     109671
-------------------------------------------------------------------------------------------------

         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~20 |      0.83       0.67       0.60       0.58       0.31       0.38       0.25       1.24
   20~30 |      1.11       0.71       0.53       0.88       0.62       1.21       1.43       9.49
   30~40 |      0.50       1.13       0.69       0.73       0.44       1.08       2.10      11.47
   40~50 |      0.82       1.45       2.07       0.43       0.35       0.55       3.77      17.20
   50~60 |      0.82       1.08       1.19       1.07       0.47       0.83       4.36      23.76
   60~70 |      0.95       0.67       1.00       0.81       0.71       0.96       5.25      22.93
   70~80 |      1.18       1.29       0.87       0.80       0.33       1.75      10.06      33.79
   80~90 |      1.29       1.25       1.45       0.74       0.92       3.95      15.79      36.00
  90~100 |      1.14       1.33       1.40       0.90       0.93       7.54      13.26      45.92
-------------------------------------------------------------------------------------------------
```

### TODO

- 分布の焼きなまし
    - うまくいっていた（`notebooks/process_result.ipynb`）
    - たまにスコアが下がることがあるので調整する
        - 下がった時には貪欲を使う
        - 温度の調整
    - 評価関数の検討
    - 同じグループに少し辺の数が違う候補を複数用意する
- 分布の類似度の測り方
- Nの最適化
    - ベースライン（高速なやつ）を使ってある程度幅を狭める
- グラフの構造的な違いの考察
- 難しいケースの対策

- `TODO:`の消化、コードの整備

- 同じグループに少し辺の数が違う候補を複数用意する
    - 分布の候補も増やす
- 分布の類似度
    - 次数の二乗和じゃなくて、次数の分布をそのまま評価する
- スコア計算の計算範囲を制限する
    - 必要なところだけ類似度を計算する
- 丸め誤差が起きてないかチェックする

## 11/17

- 実行時間のチェック

```
commit: ccd5c40
ave: 25135801.237
err ave: 3.528
         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~20 | 111177248   66799943   47844017   37190806   26719963   20738315   13824376   10236637
   20~30 |  88523333   50493154   38856908   28879708   21478236   16679996   11518339    6910594
   30~40 |  76558956   47691378   33488733   25576860   19308884   15021490   10841766    5305113
   40~50 |  70607280   38450769   30499961   20448920   16609376   12788444    9155818    2532416
   50~60 |  58350222   35206197   25894398   20805113   15087710   11108790    7887825    1516435
   60~70 |  51667250   32066299   22848100   18073783   13613014   10219706    7313175    1675155
   70~80 |  46989450   29995460   22952784   16645604   12361188    9171053    4578470     527527
   80~90 |  53125044   27104833   19404546   15542950   11821913    8681305    3643866     400169
  90~100 |  47151453   26170638   19377211   13960469   11716776    6841380    3441219     141826
-------------------------------------------------------------------------------------------------

         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~20 |      0.28       0.06       0.20       0.25       0.06       0.19       0.12       0.71
   20~30 |      0.68       0.41       0.47       0.38       0.48       0.75       0.52       5.37
   30~40 |      0.14       0.26       0.38       0.27       0.56       0.33       0.57       7.76
   40~50 |      0.41       0.45       0.87       0.43       0.29       0.35       1.46      18.13
   50~60 |      0.32       0.32       0.31       0.14       0.40       0.29       2.95      23.29
   60~70 |      0.26       0.33       0.53       0.33       0.10       0.57       3.75      22.14
   70~80 |      0.65       0.57       0.07       0.25       0.13       1.08       9.19      35.43
   80~90 |      0.41       0.12       0.60       0.21       0.23       1.79      12.07      36.93
  90~100 |      0.33       0.33       0.47       0.24       0.14       3.92      12.17      44.50
-------------------------------------------------------------------------------------------------

commit: bc201a3
ave: 25302715.511
err ave: 3.232
         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~20 | 109339285   66386583   48376068   37954695   26467770   20944841   13805618   10590830
   20~30 |  86377791   51464222   39408941   29615385   21917300   16907714   11657688    6953504
   30~40 |  76771541   47649108   33471992   25376402   19392051   14800617   10599045    5494614
   40~50 |  72294372   39288590   31616737   20995612   16715569   13023168    8832164    2467187
   50~60 |  60031319   35488569   26117097   20445891   15308942   10997603    7607877    1850423
   60~70 |  52016799   32998216   23648288   18110905   13252797   10291060    7493147    1943575
   70~80 |  48549388   31209023   22155653   16557821   12262308    9444799    4976973     980970
   80~90 |  54390217   26478266   19328320   15545564   11829709    9072446    3933893     631394
  90~100 |  48104005   26180283   18855262   13812378   11624113    7283819    4145185     177793
-------------------------------------------------------------------------------------------------

         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~20 |      0.44       0.11       0.10       0.08       0.12       0.12       0.12       0.33
   20~30 |      1.00       0.18       0.32       0.12       0.29       0.67       0.38       5.17
   30~40 |      0.14       0.30       0.38       0.36       0.50       0.50       0.81       7.12
   40~50 |      0.12       0.23       0.47       0.21       0.24       0.15       1.85      16.60
   50~60 |      0.05       0.24       0.23       0.29       0.27       0.38       3.23      22.00
   60~70 |      0.21       0.06       0.20       0.33       0.33       0.48       3.25      20.71
   70~80 |      0.29       0.19       0.40       0.30       0.20       0.83       7.62      32.00
   80~90 |      0.12       0.38       0.60       0.21       0.23       1.26      10.71      32.67
  90~100 |      0.10       0.40       0.73       0.33       0.21       3.23       9.96      43.17
-------------------------------------------------------------------------------------------------

commit: ffe09a8
ave: 25427338.62
err ave: 3.197
         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~20 | 109144748   67196769   48344017   37630367   26511630   21069841   13872822   10297004
   20~30 |  88997017   51649690   39893220   29734242   21710972   17267420   11053067    6861281
   30~40 |  77069160   48081568   34348108   25756785   19586810   14913104   10805581    5623802
   40~50 |  70542738   38608894   31272251   20972685   16802074   13098798    8917668    2660075
   50~60 |  58666961   35206600   26243574   20624463   15415781   11253879    7782383    1748850
   60~70 |  52495267   32984988   23485799   18110489   13453597   10399747    7558881    1482620
   70~80 |  49675651   31305297   22420653   16458707   12333960    9622405    5082805     651167
   80~90 |  54717015   27086558   19902529   15615227   11922585    9228826    4406259     574680
  90~100 |  47905593   26388776   19917462   13822677   11542764    7447352    4361144     224364
-------------------------------------------------------------------------------------------------

         |    0~0.05   0.05~0.1   0.1~0.15   0.15~0.2   0.2~0.25   0.25~0.3   0.3~0.35   0.35~0.4
-------------------------------------------------------------------------------------------------
   10~20 |      0.44       0.00       0.10       0.17       0.12       0.06       0.08       0.62
   20~30 |      0.63       0.18       0.21       0.12       0.38       0.46       0.90       5.23
   30~40 |      0.07       0.22       0.12       0.23       0.44       0.42       0.62       6.82
   40~50 |      0.47       0.41       0.60       0.21       0.18       0.10       1.69      16.27
   50~60 |      0.27       0.32       0.19       0.21       0.20       0.17       3.00      22.82
   60~70 |      0.11       0.06       0.27       0.33       0.19       0.39       3.62      23.14
   70~80 |      0.06       0.14       0.33       0.35       0.13       0.58       8.44      31.93
   80~90 |      0.06       0.12       0.35       0.16       0.15       1.16       9.79      34.20
  90~100 |      0.14       0.27       0.20       0.33       0.29       3.15       9.39      42.67
-------------------------------------------------------------------------------------------------
```

- 焼きなましのスコア遷移のチェック
    - 概ね良し
        - 温度調整の余地はある
- 焼きなましの高速化
    - 必要部分のみの計算
        - 3倍速くなった、スコアは変わらず

### TODO:

- マトリックスの類似度
    - 次数が大きい順に並べる
- 分布の追加
    - ランダムに追加する個数の調整
- 構築の高速化
    - ボトルネックはシミュレーション
- 類似度関数の検討
- extremeの時のスコア減少の調査
- 各種パラメータを集めて、調整する
- 下駄の調整
    - 必要かどうかの調査する
        - 必要らしい
    - 必要なら大きさの検討
- Nの再調整
    - 有望なところだけ調べる
- 焼きなましの調整
    - 初期解の検討
    - 温度調整
        - epsが大きいケースは温度を上げると良い

## 11/18

- マトリックスの類似度
    - 次数が大きい順に並べる
    - まずpythonで可視化してみる
        - windowを作って計算量削減する

- 初期解がよければ、分布は増やしても大丈夫
    - 分布を増やすと難しいケースに強くなる
- 分布の辺の数はランダムにして多様性を持たせた方がいい
    - ランダム幅の調整
